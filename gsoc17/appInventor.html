<h1 id="design-challenge">Design Challenge</h1>
<p>This challenge involved solving two problems with respect to the code base of AppInventor.</p>
<ol style="list-style-type: decimal">
<li><p>AppInventor has a component called Camera which allowed users to open a front camera by default. However, this feature stopped working on newer versions of android. The first part of the challenge required us to find out the reason for it. I figured that the problem lies in the takePicture() method in <a href="https://github.com/mit-cml/appinventor-sources/blob/master/appinventor/components/src/com/google/appinventor/components/runtime/Camera.java">Camera.java</a>. The TakePicture() invokes Camera via the IMAGE_CAPTURE implicit intent. The Camera.java class has a property called <em>userFront</em>. The TakePicture() method checks if <em>useFront</em> is set to true. If it is set to true then it adds an <em>extra</em> to the intent that invokes Camera with the statement <em>intent.putExtra(&quot;android.intent.extras.CAMERA_FACING&quot;, 1)</em>. This indicates that the front camera should open by default if the property is set to true. However, the &quot;android.intent.extras.CAMERA_FACING&quot; is an undocumented feature in Android and does not work for newer versions of Android. Since, newer android stopped supporting this feature <em>useFront</em> stopped working and had to be removed from AppInventor.</p></li>
<li><p>The second part of the challenge required us to design a feature that would allow users to automatically take pictures. To implement this feature all we need to do is add a method in the class Camera.java (discussed in the point 1) and annotate it with <em><span class="citation">@SimpleFunction</span></em>. Lets call this function <em>TakePictureAuto()</em>. Inside this method we use the Camera API to automatically click a picture, store it in internal storage and trigger the <em>AfterPicture</em> event just like in <em>TakePicture()</em>. Note it is important to annotate <em>TakePictureAuto()</em> with <em><span class="citation">@SimpleFunction</span></em> because that would make it visible to the user in the Blocks editor, allowing her to invoke this function from the blocks editor. Following is a code snippet for TakePictureAuto:</p></li>
</ol>
<p>``` Camera camera; int CameraId; private String imageFileName;</p>
<p><span class="citation">@SimpleFunction</span> public void TakePictureAuto(){ int cameraId = findCamera(); if(cameraId &lt; 0) raise Error; else camera = Camera.open(CameraId); camera.startPreview(); camera.takePicture(null,null,new PhotoHandler(container.$context)); AfterPicture(new File(context.getFilesDir(), imageFileName).toString());<br /> }</p>
<p>/<em> get a camera id </em>/ private int findCamera(){ int cameraId = -1; int numberOfCameras = Camera.getNumberOfCameras(); for(int i = 0;i &lt; numberOfCameras;i++){ Camera.CameraInfo cameraInfo = new Camera.CameraInfo(); Camera.getCameraInfo(i,cameraInfo); cameraId = i; break; } return cameraId; } /<em> handle the onPictureTaken event and save the image in internal storage. </em>/ private class PhotoHandler implements Camera.PictureCallback { private final String TAG = &quot;PhotoHandler&quot;; <span class="citation">@Override</span> public void onPictureTaken(byte[] data, Camera camera){ imageFileName = &quot;app_inventor_&quot; + new Date().getTime(); FileOutputStream outputStream; try{ outputStream = container.<span class="math"><em>c</em><em>o</em><em>n</em><em>t</em><em>e</em><em>x</em><em>t</em>.<em>o</em><em>p</em><em>e</em><em>n</em><em>F</em><em>i</em><em>l</em><em>e</em><em>O</em><em>u</em><em>t</em><em>p</em><em>u</em><em>t</em>(<em>i</em><em>m</em><em>a</em><em>g</em><em>e</em><em>F</em><em>i</em><em>l</em><em>e</em><em>N</em><em>a</em><em>m</em><em>e</em>,â€†<em>c</em><em>o</em><em>n</em><em>t</em><em>a</em><em>i</em><em>n</em><em>e</em><em>r</em>.</span>context.MODE_PRIVATE); outputStream.write(data); } catch(FileNotFoundException fe){ fe.printStackTrace(); Log.d(TAG,imageFile + &quot;not found&quot;); } catch(IOException ioe){ ioe.printStackTrace(); Log.d(TAG,&quot;error occurred while writing to &quot; + imageFile); } catch(Exception e){ e.printStackTrace(); Log.d(TAG,&quot;error occurred but not related to IO&quot;); } } } ``` <em>Note I use internal storage to save the image as opposed to external storage because saving in internal stroage is more secure. The TakePicture() method stores images in external storage though. I could have done the same but I am not sure why that is required. Maybe I am missing a nuance which is why I am documenting it.</em></p>
